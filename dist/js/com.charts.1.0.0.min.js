var comCharts=function(){return TimeSeries.Query=function(){var a=function(a,b,c){var d=TimeSeries.query_data[a];TimeSeries.query_data[a].custom_internal_dimension_||(TimeSeries.query_data[a].custom_internal_dimension_=d.cf.dimension(function(a){return"a"})),TimeSeries.query_data[a][b+"_dimension_"]=d.cf.dimension(function(a){for(var b,d,e,f="",g="|+|",h=c.length,i=0;h>i;i++)0===i&&(g=""),"object"==typeof c[i]?(e=Object.keys(c[i])[0],d=c[i][e]):d=c[i],b="function"==typeof d?e:d,"function"==typeof d?f=d(a):""===g&&1===h?f=a[d]:f+=a[d]+g;return f})},b=function(b,c,d){TimeSeries.query_data[b][c].query_config.metric||(TimeSeries.query_data[b][c].query_config.metric=d.metric,d=d.metric);for(var e=TimeSeries.query_data[b],f=d.length,g=0;f>g;g++){var h=Object.keys(d[g])[0];e.hasOwnProperty(c+"_dimension_")||a(b,c,[h]);var i,j=h,k=d[g][h];i=i?"1e-"+i:"1e-2";var l=function(a){return"function"==typeof k?k(a):+a[j]},m=function(a,b){var c=isNaN(+b[j])?0:+b[j];switch(k){case"count":return a+1;case"sum":return a+=parseFloat(c),+i>a&&(a=0),a;case"min":return"a"===a&&(a=+c),a=+c>a?a:+c;case"max":return"a"===a&&(a=+c),a=a>+c?a:+c;case"median":a.arr.push(+c),a.arr.sort(function(a,b){return a-b});var d=Math.floor(a.arr.length/2);return a.arr.length%2?(a.val=a.arr[d],a):(a.val=(a.arr[d-1]+a.arr[d])/2,a);case"avg":return++a.count,a.sum+=+c,a.val=a.sum/a.count,a.sum<=0&&(a.val=0),a;case"value":return a.val=c,a;case"std":a.arr.push(+c),++a.count,a.sum+=+c,a.mean=a.sum/a.count;for(var e=0,f=0;f<a.count;f++)e+=Math.pow(a.arr[f]-a.mean,2);return a.variance=e/a.count,a.std=Math.sqrt(a.variance),a;default:return l(b)}},n=function(a,b){var c=isNaN(+b[j])?0:+b[j];switch(k){case"count":return a-1;case"sum":return a-=parseFloat(c),+i>a&&(a=0),a;case"min":return"a"===a&&(a=+c),a=+c>a?a:+c;case"max":return"a"===a&&(a=+c),a=a>+c?a:+c;case"mean":break;case"median":a.arr.push(+c),a.arr.sort(function(a,b){return a-b});var d=Math.floor(a.arr.length/2);return a.arr.length%2?(a.val=a.arr[d],a):(a.val=(a.arr[d-1]+a.arr[d])/2,a);case"avg":return a.sum-=+c,--a.count,a.val=a.sum/a.count,a.sum<=0&&(a.val=0),a;case"value":return a.val=c,a;case"std":a.arr.push(+c),++a.count,a.sum-=+c,a.mean=a.sum/a.count;for(var e=0,f=0;f<a.count;f++)e+=Math.pow(a.arr[f]-a.mean,2);return a.variance=e*a.count,a.std=Math.sqrt(a.variance),a;default:return l(b)}},o=function(){switch(k){case"count":return 0;case"sum":return 0;case"min":return"a";case"max":return"a";case"mean":break;case"median":return{val:0,arr:[]};case"avg":return{count:0,sum:0,val:0};case"value":return{val:0};case"std":return{mean:0,variance:0,deviation:0,sum:0,count:0,arr:[]};default:return 0}};e[c].query_config.dimension?TimeSeries.query_data[b][c+"_metric_"]=e[c+"_dimension_"].group().reduce(m,n,o):TimeSeries.query_data[b][c+"_metric_"]=e.custom_internal_dimension_.group().reduce(m,n,o)}},c=function(b,c,d){var e,f=TimeSeries.query_data[b];e="object"==typeof f[c].query_config.dimension[0]?Object.keys(f[c].query_config.dimension[0])[0]:f[c].query_config.dimension[0];for(var g=0;g<d.length;g++){var h,i=d[g].column,j=d[g].condition,k=d[g].values;switch(j){case"Equal":h=function(a){return a===k};break;case"NotEqual":h=function(a){return a!==k};break;case"LessThan":h=function(a){return k>a};break;case"GreaterThan":h=function(a){return a>k};break;case"LessThanEqual":h=function(a){return k>=a};break;case"GreaterThanEqual":h=function(a){return a>=k};break;case"Between":h=function(a){return a>=k[0]&&a<=k[1]};break;case"NotBetween":h=function(a){return a<k[0]&&a>k[1]};break;case"In":h=function(a){return-1!==k.indexOf(a)};break;case"NotIn":h=function(a){return-1===k.indexOf(a)};break;case"IsNull":h=function(a){return void 0===a||null===a};break;case"IsNotNull":h=function(a){return void 0!==a&&null!==a};break;case"Eval":h=k}1===f[c].query_config.dimension.length&&e===i?TimeSeries.query_data[b][c+"_dimension_"].filter(h):(a(b,i,[i]),TimeSeries.query_data[b][i+"_dimension_"].filter(h))}},d=function(a,b,c,d){var e=TimeSeries.query_data[a][b].query_config;e.filter_impacts&&delete e.filter_impacts,e.data_impacts&&delete e.data_impacts,f(c,b,e);var g={};g[c]=d,TimeSeries.query_data[a][b].query_config.filter_impacts?TimeSeries.query_data[a][b].query_config.filter_impacts.push(g):TimeSeries.query_data[a][b].query_config.filter_impacts=[g]},e=function(a,b,c,d){var e,g,h=TimeSeries.query_data[a][b].query_config.data_impacts;for(e=0;e<h.length&&h[e]!==a;e++){var j=h[e],k=Object.keys(TimeSeries.query_data[j]);for(g=0;g<k.length;g++)k[g].match("_dimension_")?(TimeSeries.query_data[j][k[g]].filterAll(),TimeSeries.query_data[j][k[g]].dispose(),delete TimeSeries.query_data[j][k[g]]):k[g].match("_metric_")&&(TimeSeries.query_data[j][k[g]].dispose(),delete TimeSeries.query_data[j][k[g]]);for(TimeSeries.query_data[j].cf.remove(),TimeSeries.query_data[j].cf.add(c),k=Object.keys(TimeSeries.query_data[j]),g=0;g<k.length;g++)if("cf"!==k[g]&&!k[g].match("_dimension_")&&!k[g].match("_metric_")&&(f(j,k[g],TimeSeries.query_data[j][k[g]].query_config),TimeSeries.query_data[j][k[g]].query_config.data_impacts)){i(j,k[g])}}},f=function(e,f,g){var h;if(TimeSeries.query_data[e][f]={query_config:g},TimeSeries.query_data[e][f].query_config.dimension&&a(e,f,TimeSeries.query_data[e][f].query_config.dimension),TimeSeries.query_data[e][f].query_config.metric&&b(e,f,TimeSeries.query_data[e][f].query_config.metric),TimeSeries.query_data[e][f].query_config.filter&&c(e,f,TimeSeries.query_data[e][f].query_config.filter),TimeSeries.query_data[e][f].query_config.filter_impacted_by){var i=TimeSeries.query_data[e][f].query_config.filter_impacted_by;for(h=0;h<i.length;h++)d(Object.keys(i[h])[0],i[h][Object.keys(i[h])[0]],e,f)}if(TimeSeries.query_data[e][f].query_config.data_impacted_by){var j=TimeSeries.query_data[e][f].query_config.data_impacted_by;for(h=0;h<j.length;h++){var k=Object.keys(j[h])[0],l=j[h][k];if(TimeSeries.query_data[k][l].query_config.data_impacts){if(-1!==TimeSeries.query_data[k][l].query_config.data_impacts.indexOf(e))continue;TimeSeries.query_data[k][l].query_config.data_impacts.push(e)}else TimeSeries.query_data[k][l].query_config.data_impacts=[e]}}if(TimeSeries.query_data[e][f].query_config.data_impacts)if(TimeSeries.query_data[e][f].query_config.data_impacts){var m=g.data_impacts,n=m.length;for(h=0;n>h;h++)-1===TimeSeries.query_data[e][f].query_config.data_impacts.indexOf(m[h])&&TimeSeries.query_data[e][f].query_config.data_impacts.push(m[h])}else TimeSeries.query_data[e][f].query_config.data_impacts=g.data_impacts},g=function(a,b,d){TimeSeries.query_data[a][b].query_config.filter?TimeSeries.query_data[a][b].query_config.filter.push.apply(TimeSeries.query_data[a][b].query_config.filter,d):TimeSeries.query_data[a][b].query_config.filter=d,c(a,b,d);var e=TimeSeries.query_data[a][b].query_config.filter_impacts;if(e)for(var f=0;f<e.length;f++){var h=Object.keys(e[f])[0];if(h===a)break;g(h,b,d)}},h=function(a,b,c){var d,e,f,g=TimeSeries.query_data[a][b].query_config.filter_impacts,i=TimeSeries.query_data[a][b].query_config.filter;for(i&&(f=i.length),TimeSeries.query_data[a][b+"_dimension_"]&&TimeSeries.query_data[a][b+"_dimension_"].filterAll(),d=0;d<c.length;d++)for(TimeSeries.query_data[a][c[d].column+"_dimension_"]&&TimeSeries.query_data[a][c[d].column+"_dimension_"].filterAll(),e=0;f>e;e++)c[d].condition||c[d].values||i[e]||i[e].column===c[d].column&&(TimeSeries.query_data[a][b].query_config.filter.splice(e,1),i.splice(e,1),e--);if(g)for(d=0;d<g.length;d++){var j=Object.keys(g[d])[0];if(j===a)break;h(j,b,c)}},i=function(a,b,c){var d,f,g,h,i,k,l,m={};try{c||(c={}),c.sort&&(f=Object.keys(c.sort)[0],g=c.sort[f])}catch(n){console.error("Sort syntax is not proper")}if(!TimeSeries.query_data[a][b])return!1;TimeSeries.query_data[a][b].query_config.metric?(h=c.metric,m=TimeSeries.query_data[a][b].query_config.metric[0],k=Object.keys(TimeSeries.query_data[a][b].query_config.metric[0])[0],d=b+"_metric_"):TimeSeries.query_data[a][b].query_config.dimension?(h=c.dimension,d=b+"_dimension_"):d=b+"_dimension_";try{i="asc"==f&&"dataquerykey"==g?TimeSeries.query_data[a][d].all():"asc"==f&&"dataqueryvalue"==g?TimeSeries.query_data[a][d].top(1/0,"asc"):"desc"==f&&"dataquerykey"==g?TimeSeries.query_data[a][d].all("desc"):"desc"==f&&"dataqueryvalue"==g?TimeSeries.query_data[a][d].top(1/0):TimeSeries.query_data[a][d].top(1/0,"asc")}catch(n){console.error("Metric ,Dimension is not created or exist")}var o,p=i.length;if("avg"==m[k])for(dataset=JSON.parse(JSON.stringify(i)),o=0;p>o;o++){var q=dataset[o].value.val;dataset[o].value=q}else dataset=JSON.parse(JSON.stringify(i));if(c.filter){var r,s,t,u;if(c.filter instanceof Array)for(o=0;o<c.filter.length;o++)r=c.filter[o],s=r.condition,t=r.column,u=r.values,dataset=dataset.filter(j(s,t,u));else r=c.filter,s=r.condition,t=r.column,u=r.values,dataset=dataset.filter(j(s,t,u))}return c.bottom&&"number"==typeof c.bottom?l=dataset.slice(dataset.length-c.bottom<0?0:dataset.length-c.bottom,dataset.length):c.top&&"number"==typeof c.bottom&&(l=dataset.slice(0,c.top>dataset.length?dataset.length:c.top)),c.propagateData!==!1&&TimeSeries.query_data[a][b].query_config.data_impacts&&e(a,b,l?l:dataset),l?l:dataset},j=function(a,b,c){switch(a){case"Equal":filter_function=function(a){return(""+a.key).indexOf("||")>0?(""+a.key).split("||").indexOf(c)>-1?(a.key=+a.key.split("||")[0],!0):!1:"object"==typeof a[b]?a[b].val===c:a[b]===c};break;case"NotEqual":filter_function=function(a){return(""+a.key).indexOf("||")>0?(""+a.key).split("||").indexOf(c)>-1?(a.key=+a.key.split("||")[0],!0):!1:a[b]!==c};break;case"LessThan":filter_function=function(a){return(""+a.key).indexOf("||")>0?(""+a.key).split("||").indexOf(c)>-1?(a.key=+a.key.split("||")[0],!0):!1:a[b]<c};break;case"GreaterThan":filter_function=function(a){return(""+a.key).indexOf("||")>0?(""+a.key).split("||").indexOf(c)>-1?(a.key=+a.key.split("||")[0],!0):!1:a[b]>c};break;case"LessThanEqual":filter_function=function(a){return(""+a.key).indexOf("||")>0?(""+a.key).split("||").indexOf(c)>-1?(a.key=+a.key.split("||")[0],!0):!1:a[b]<=c};break;case"GreaterThanEqual":filter_function=function(a){return(""+a.key).indexOf("||")>0?(""+a.key).split("||").indexOf(c)>-1?(a.key=+a.key.split("||")[0],!0):!1:a[b]>=c};break;case"Between":filter_function=function(a){return(""+a.key).indexOf("||")>0?(""+a.key).split("||").indexOf(c)>-1?(a.key=+a.key.split("||")[0],!0):!1:a[b]>=c[0]&&a[b]<=c[1]};break;case"NotBetween":filter_function=function(a){return(""+a.key).indexOf("||")>0?(""+a.key).split("||").indexOf(c)>-1?(a.key=+a.key.split("||")[0],!0):!1:a[b]<c[0]&&a[b]>c[1]};break;case"In":filter_function=function(a){return(""+a.key).indexOf("||")>0?(""+a.key).split("||").indexOf(c)>-1?(a.key=+a.key.split("||")[0],!0):!1:-1!==c.indexOf(a[b])};break;case"NotIn":filter_function=function(a){return(""+a.key).indexOf("||")>0?(""+a.key).split("||").indexOf(c)>-1?(a.key=+a.key.split("||")[0],!0):!1:-1===c.indexOf(a[b])};break;case"IsNull":filter_function=function(a){return(""+a.key).indexOf("||")>0?(""+a.key).split("||").indexOf(c)>-1?(a.key=+a.key.split("||")[0],!0):!1:void 0===a[b]||null===a[b]};break;case"IsNotNull":filter_function=function(a){return(""+a.key).indexOf("||")>0?(""+a.key).split("||").indexOf(c)>-1?(a.key=+a.key.split("||")[0],!0):!1:void 0!==a[b]&&null!==a[b]};break;case"Eval":filter_function=c}return filter_function},k=function(a,b){return TimeSeries.query_data[a]={cf:crossfilter(b)},!0},l=function(a,b,c,d){if("all"===c){for(var e=Object.keys(TimeSeries.query_data[a]),f=0;f<e.length;f++)e[f].match("_dimension_")&&TimeSeries.query_data[a][e[f]].filterAll();TimeSeries.query_data[a].cf.remove(),TimeSeries.query_data[a].cf.add(b)}else TimeSeries.addFilter(a,"query",[{column:"x",condition:"Between",values:d}]),TimeSeries.query_data[a].cf.remove(),TimeSeries.removeFilter(a,"query",[{column:"x",condition:"Between",values:d}]),TimeSeries.query_data[a].cf.add(b)},m=function(a,b){try{TimeSeries.query_data[a]?(TimeSeries.query_data[a][b]&&delete TimeSeries.query_data[a][b],TimeSeries.query_data[a][b+"_dimension_"]&&(TimeSeries.query_data[a][b+"_dimension_"].remove(),TimeSeries.query_data[a][b+"_dimension_"].dispose(),delete TimeSeries.query_data[a][b+"_dimension_"]),TimeSeries.query_data[a][b+"_metric_"]&&(TimeSeries.query_data[a][b+"_metric_"].remove(),TimeSeries.query_data[a][b+"_metric_"].dispose(),delete TimeSeries.query_data[a][b+"_metric_"])):console.error("Table Name "+a+" does not Exist")}catch(c){console.error("Error in Table name or query name")}};return{init:k,setQuery:f,addFilter:g,removeFilter:h,getData:i,updateData:l,deleteQuery:m,createMetric:b}}(),TimeSeries.dataManipulationFunctions=function(){var a=function(a,b,d,e,f){for(var g=d-b,h=(g>>>1)+1;--h>0;)c(a,h,g,b,e);return a},b=function(a,b,d,e,f){for(var g,h=d-b;--h>0;)g=a[b],a[b]=a[b+h],a[b+h]=g,c(a,1,h,b,e);return a.reverse()},c=function(a,b,c,d,e,f){var g=a[--d+b];"TimeStamp"===f?(a[d+b][e]=new Date(parseInt(g[e])).getTime(),g[e]=new Date(parseInt(g[e])).getTime()):(a[d+b][e]=new Date(g[e]).getTime(),g[e]=new Date(g[e]).getTime()),a[d+b].isRawData=!0,g.isRawData=!0;for(var h,i=g[e];(h=b<<1)<=c&&(c>h&&("TimeStamp"===f?(a[d+h][e]=new Date(parseInt(a[d+h][e])).getTime(),a[d+h+1][e]=new Date(parseInt(a[d+h+1][e])).getTime()):(a[d+h][e]=new Date(a[d+h][e]).getTime(),a[d+h+1][e]=new Date(a[d+h+1][e]).getTime()),a[d+h].isRawData=!0,a[d+h+1].isRawData=!0,a[d+h][e]>a[d+h+1][e]&&h++),!(i<=a[d+h][e]));)a[d+b]=a[d+h],b=h;a[d+b]=g},d=function(c,d,e,f){if(!f.isDataSorted){var g=a(c,0,c.length,d,e);return b(g,0,g.length,d,e)}return c},e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],f=["January","February","March","April","May","June","July","August","September","October","November","December"],g=function(a,b,c,d,g){var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=a.length,z=[],A=-1,B=[],C=-1,D=[],E=-1,F=[],G=-1,H=[],I=-1,J=[],K=-1,L=[],M=[],N=-1,O=0,P=TimeSeries.global_data_sets[g.data].alias,Q={},R=[];for(k=0;y>k;k++)if(g.minGranularity||g.maxGranularity||(m=a[k],"TimeStamp"===d||"YYYYMMDD"===d||"YYYYMMDDHH"===d||"YYYYMMDDHHMM"===d||"YYYYMMDDHHMMSS"===d?("YYYYMMDD"===d||"YYYYMMDDHH"===d||"YYYYMMDDHHMM"===d||"YYYYMMDDHHMMSS"===d?(date_temp=m[b],modified_date=[date_temp.slice(0,4),"/",date_temp.slice(4,6),"/",date_temp.slice(6,8)].join(""),"YYYYMMDDHH"===d?modified_time=[date_temp.slice(8,10),"00","00"].join(":"):"YYYYMMDDHHMM"===d?modified_time=[date_temp.slice(8,10),date_temp.slice(10,12),"00"].join(":"):"YYYYMMDDHHMMSS"===d?modified_time=[date_temp.slice(8,10),date_temp.slice(10,12),date_temp.slice(12,14)].join(":"):modified_time="00:00:00",l=new Date([modified_date,modified_time].join(" "))):l=new Date(parseInt(m[b])),a[k][TimeSeries.global_data_sets[g.data][b]||b]=l.getTime(),a[k].isRawData=!0,z[A]!=l.getFullYear()&&(z.push(l.getFullYear()),A++),B[C]!=l.getMonth()+1&&(B.push(l.getMonth()+1),C++),D[E]!=l.getDate()&&(D.push(l.getDate()),E++),F[G]!=l.getHours()&&(F.push(l.getHours()),G++),H[I]!=l.getMinutes()&&(H.push(l.getMinutes()),I++),J[K]!=l.getSeconds()&&(J.push(l.getSeconds()),K++)):(l=new Date(m[b]),v=m[b].match(c.regex),n=c.mapping[0]+1,o=c.mapping[1]+1,p=c.mapping[2]+1,q=c.mapping[3]+1,r=c.mapping[4]+1,s=c.mapping[5]+1,a[k][TimeSeries.global_data_sets[g.data][b]||b]=l.getTime(),a[k].isRawData=!0,-1!=n&&z[A]!=v[n]&&void 0!==v[n]&&(z.push(+v[n]),A++),-1!=o&&B[C]!=+v[o]&&void 0!==v[o]&&(w=e.indexOf(v[o]),x=f.indexOf(v[o]),B.push(-1!==w?w+1:-1!==x?x+1:+v[o]),C++),-1!=p&&D[E]!=v[p]&&void 0!==v[p]&&(D.push(+v[p]),E++),-1!=q&&F[G]!=v[q]&&void 0!==v[q]&&(F.push(+v[q]),G++),-1!=r&&H[I]!=v[r]&&void 0!==v[r]&&(H.push(+v[r]),I++),-1!=s&&J[K]!=v[s]&&void 0!==v[s]&&(J.push(+v[s]),K++))),g.processMissingDataPoint&&(R.push(a[k][b]),g.minimumTimeStep?t=JSON.parse(JSON.stringify(a[0])):k>0?(O=a[k][b]-a[k-1][b],N=L.indexOf(O),-1===N?(L.push(O),M.push(1)):M[N]=M[N]+1):t=JSON.parse(JSON.stringify(a[k]))),P)for(u in P)a[k][P[u]]||(a[k][P[u]]=a[k][u],delete a[k][u]);if(!g.minGranularity&&!g.maxGranularity)if(g.enableLiveData&&TimeSeries.chart_configs[g.selector].data_processed){var S=TimeSeries.chart_configs[g.selector].data_processed.min_max_granularity[2];Q.min_max_granularity=i(S[0].length>0?S[0].concat(z):z,S[1].length>0?S[1].concat(B):B,S[2].length>0?S[2].concat(D):D,S[3].length>0?S[3].concat(F):F,S[4].length>0?S[4].concat(H):H,S[5].length>0?S[5].concat(J):J)}else Q.min_max_granularity=i(z,B,D,F,H,J);return g.processMissingDataPoint&&(L.length>1||g.minimumTimeStep)?(g.minimumTimeStepGranularity=g.minimumTimeStepGranularity?g.minimumTimeStepGranularity:Q.min_max_granularity[0],Q.data=a.concat(h(a,b,g.minimumTimeStep,g.minimumTimeStepGranularity,R,L,M,t))):Q.data=a,g.width&&(Q.initial_zoom_level=j(g,Q.min_max_granularity[2],a,b)),Q},h=function(a,b,c,d,e,f,g,h){var i,j,k,l,m=0,n=0,o=1,p=[],q=0,r=[],s=[];for(j in h)h[j]="NA";if(c)n=c;else{switch(g.areAllValuesSame()?n=Math.min.apply(Math,g):(m=g.indexOf(Math.max.apply(Math,g)),n=f[m]),d){case"second":o=1e3;break;case"minute":o=6e4;break;case"hour":o=36e5;break;case"day":o=864e5;break;case"month":o=2592e6;break;case"second":o=31104e6}n=Math.floor(n/o)}for(k=d3.extent(a,function(a){return a[b]}),l=d3.time[d].rangePlusBinaryForMDP(k[0],k[1],n,e),p=l[0],r=l[1],q=r.length,i=0;q>i;i++)1===r[i]&&(h=JSON.parse(JSON.stringify(h)),h[b]=p[i],h.isRawData=!1,s.push(h));return s},i=function(a,b,c,d,e,f){var g,h,i,j=a.unique(),k=b.unique(),l=c.unique(),m=d.unique(),n=e.unique(),o=f.unique();return j.length>1?h="year":k.length>1?h="month":l.length>1?h="day":m.length>1?h="hour":n.length>1?h="minute":o.length>1&&(h="second"),o.length>1?g="second":n.length>1?g="minute":m.length>1?g="hour":l.length>1?g="day":k.length>1?g="month":j.length>1&&(g="year"),i=[j,k,l,m,n,o],[g,h,i]},j=function(a,b,c,d){var e=a.width*a.dataPointsPerPixel;return Math.round(e)},k=function(a,b){var c=a.length;if(b>=c)return a;b/=2;for(var d,e,f,g=Math.ceil(c/b),h=[],i=0;b>i;i++)if(d=a.splice(0,g),e=d.length,e>2)f=e%2===0?e/2-1:Math.floor(e/2),h.push(d[0],d[f]),0===a.length&&h.push(d.splice(-1)[0]);else{if(d.length<=0)break;h=h.concat(d)}return h},l=function(a,b){var c,d,e,f,g,h,i=[],j=a.columnHeaders,k=j.length,l=a.rows,m=l.length,n=b.split,r=b.substitute,s=b.concat;for(c=0;m>c;c++)for(i[c]={},d=0;k>d;d++){if(i[c][b.alias[j[d].name]]=l[c][d],n&&n.length>0)for(f=n.length,e=0;f>e;e++)n[e].column===b.alias[j[d].name]&&o(i[c],n[e].column,n[e].delimeter,n[e].newColumns);if(r&&r.length>0)for(g=r.length,e=0;g>e;e++)r[e].column===b.alias[j[d].name]&&p(i[c],r[e].column,r[e].match,r[e].replace,r[e].isExact);if(s&&s.length>0)for(h=s.length,e=0;h>e;e++)q(i[c],s[e].columns,s[e].delimeter,s[e].newColumn)}return i},m=function(a,b){for(var c,d,e=[],f=a.feed.entry,g=b.dimensions,h=g.map(function(a){return"gsx$"+a}),i=b.metrics,j=i.map(function(a){return"gsx$"+a}),k=0,l=f.length;l>k;k++){for(e[k]={},c=0,d=g.length;d>c;c++)e[k][b.alias[g[c]]]=f[k][h[c]].$t;for(c=0,d=i.length;d>c;c++)e[k][b.alias[i[c]]]=f[k][j[c]].$t}return e},n=function(a,b,c,d){var e,f,g,h="object"!=typeof b?JSON.parse(b):b,i=h.length,j="";if(c){g="";for(e in h[0])d.indexOf(e)>-1&&(g+=e+",");g=g.slice(0,-1),j+=g+"\r\n"}for(f=0;i>f;f++){g="";for(e in h[f])d.indexOf(e)>-1&&(g+='"'+h[f][e]+'",');g.slice(0,g.length-1),j+=g+"\r\n"}if(""===j)return void alert("Invalid data");var k=TimeSeries.global_data_sets[a.data].dataName||"MyReport";k=k.replace(/ /g,"_");var l="data:text/csv;charset=utf-8,"+escape(j),m=document.createElement("a");m.href=l,m.style="visibility:hidden",m.download=k+".csv",document.body.appendChild(m),m.click(),document.body.removeChild(m)},o=function(a,b,c,d){var e,f=a[b].split(c),g=d.length;for(e=0;g>e;e++)a[d[e]]=f[e];return delete a[b],a},p=function(a,b,c,d,e){var f,g=c.length;if(e){for(f=0;g>f;f++)c[f]=c[f].toLowerCase();c.indexOf(a[b].toLowerCase())>-1&&(a[b]=d)}else regex=new RegExp("[a-z A-Z0-9\\(\\)\\!\\@\\#\\$\\%\\^\\&\\*\\_\\+\\-\\=\\[\\]\\{\\}\\;\\'\\:\\\"\\\\\\/\\|\\, ]*"+c.join("[a-z A-Z0-9\\(\\)\\!\\@\\#\\$\\%\\^\\&\\*\\_\\+\\-\\=\\[\\]\\{\\}\\;\\'\\:\\\"\\\\\\/\\|\\, ]*|[a-z A-Z0-9\\(\\)\\!\\@\\#\\$\\%\\^\\&\\*\\_\\+\\-\\=\\[\\]\\{\\}\\;\\'\\:\\\"\\\\\\/\\|\\, ]*")+"[a-z A-Z0-9\\(\\)\\!\\@\\#\\$\\%\\^\\&\\*\\_\\+\\-\\=\\[\\]\\{\\}\\;\\'\\:\\\"\\\\\\/\\|\\, ]*","gi"),a[b]=a[b].replace(regex,d);return a},q=function(a,b,c,d){var e,f=b.length;for(a[d]="",e=0;f>e;e++)a[d]+=a[b[e]];return a};return TimeSeries.mediator.subscribe("dataProcessing",g),TimeSeries.mediator.subscribe("heapSort",d),TimeSeries.mediator.subscribe("findMissingDataPoint",h),TimeSeries.mediator.subscribe("simplifyDataset",k),TimeSeries.mediator.subscribe("transformGAData",l),TimeSeries.mediator.subscribe("transformGSXData",m),TimeSeries.mediator.subscribe("downloadDataURI",n),{dataProcessing:g,sort:d,simplifyDataset:k,findMissingDataPoint:h,mmm_array:e,mmmm_array:f,week_day_array:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}}(),TimeSeries.getData=function(){var a=function(a,b){var c;return"smartDefault"!==b.dataFormat?c=b.dataFormat:a.constructor==Array?c="json_obj":-1!=a.indexOf("[")&&-1!=a.indexOf("{")?c="json_string":"string"==typeof a&&-1!=a.indexOf(",")?c="csv_string":a.indexOf(".json")>-1?c="json":a.indexOf(".csv")>-1?c="csv":a.indexOf("json")>-1?c="json":a.indexOf("csv")>-1&&(c="csv"),c},b=function(b,c,d,e,f){var g,h=d.options.selector,i=a(b,d.options);switch(TimeSeries.chart_status[h].status===!1&&(TimeSeries.chart_status[h].status="inprogress"),d.options.dataSource){case"google-analytics":var j,k;g=new XMLHttpRequest,j=TimeSeries.mediator.publish("createGAQuery",d.options),g.onreadystatechange=function(){4==g.readyState&&200==g.status&&(console.log(JSON.parse(g.responseText)),k=TimeSeries.mediator.publish("transformGAData",JSON.parse(g.responseText),d.options),TimeSeries.mediator.publish(c,d,k,e,f))},j=j[j.name],g.open("GET",j.query,!0),g.send();break;case"google-sheets":var l,m=TimeSeries.mediator.publish("createGSXQuery",d.options);g=new XMLHttpRequest,g.onreadystatechange=function(){4==g.readyState&&200==g.status&&(console.log(JSON.parse(g.responseText)),l=TimeSeries.mediator.publish("transformGSXData",JSON.parse(g.responseText),d.options),console.log("gsx_data",l),TimeSeries.mediator.publish(c,d,l,e,f))},g.open("GET",m,!0),g.setRequestHeader("Authorization","Bearer "+d.options.accessToken),g.send();break;case"":switch(i){case"json_obj":TimeSeries.mediator.publish(c,d,b,e,f);break;case"json_string":b=JSON.parse(b),TimeSeries.mediator.publish(c,d,b,e,f);break;case"csv_string":b=Papa.parse(b),TimeSeries.mediator.publish(c,d,b.data,e,f);break;case"json":d3.json(b,function(a){TimeSeries.mediator.publish(c,d,a,e,f)});break;case"csv":Papa.parse(b,{download:!0,header:!0,complete:function(a){TimeSeries.mediator.publish(c,d,a.data,e,f)}})}}},c=function(b,c,d){var e=TimeSeries.global_data_sets[d];switch(format=a(b,e),console.log(b,c,d),TimeSeries.data_load_status[d].status===!1&&(TimeSeries.data_load_status[d].status="inprogress"),e.dataSource){case"google-analytics":var f,g,h=new XMLHttpRequest;f=TimeSeries.mediator.publish("createGAQuery",e),h.onreadystatechange=function(){4==h.readyState&&200==h.status&&(g=TimeSeries.mediator.publish("transformGAData",JSON.parse(h.responseText),e),TimeSeries.data_load_status[d].status="complete",TimeSeries.global_data_sets[d].raw_data=g,console.time("dataSource"),TimeSeries.mediator.publish(c,d,"data",g),console.timeEnd("dataSource"))},f=f[f.name],h.open("GET",f.query,!0),h.send();break;case"google-sheets":var i,j=TimeSeries.mediator.publish("createGSXQuery",e);h=new XMLHttpRequest,h.onreadystatechange=function(){4==h.readyState&&200==h.status&&(i=TimeSeries.mediator.publish("transformGSXData",JSON.parse(h.responseText),e),TimeSeries.data_load_status[d].status="complete",TimeSeries.global_data_sets[d].raw_data=i,TimeSeries.mediator.publish(c,d,"data",i))},h.open("GET",j,!0),h.setRequestHeader("Authorization","Bearer "+e.accessToken),h.send();break;case"":switch(TimeSeries.data_load_status[d].status="complete",format){case"json_obj":TimeSeries.mediator.publish(c,d,"data",b);break;case"json_string":b=JSON.parse(b),TimeSeries.mediator.publish(c,d,"data",b);break;case"csv_string":b=Papa.parse(b),TimeSeries.mediator.publish(c,d,"data",b);break;case"json":d3.json(b,function(a){TimeSeries.mediator.publish(c,d,"data",a)});break;case"csv":Papa.parse(b,{download:!0,header:!0,complete:function(a){TimeSeries.mediator.publish(c,d,"data",a.data)}})}}};return TimeSeries.mediator.subscribe("parseData",b),TimeSeries.mediator.subscribe("parseGlobalData",c),TimeSeries.mediator.subscribe("getDataFormat",a),{parseData:b,getDataFormat:a}}(),TimeSeries.numberFormatFunctions=function(){var a=function(a,b){return d3.format(a)(b)};return TimeSeries.mediator.subscribe("numberFormatter",a),{numberFormatter:a}}(),TimeSeries.modal=function(){var a=d3.dispatch("click");TimeSeries.clubFeaturesInModal={edit:["impactSwitch","smoothing","anomalyDetection","viewRawData","growthViews"],timeNavigator:["timeNavigator"],smoothing:["impactSwitch","smoothing","anomalyDetection","viewRawData","growthViews"],anomalyDetection:["impactSwitch","smoothing","anomalyDetection","viewRawData","growthViews"]},TimeSeries.featureAlias={viewRawData:{alias:"Chart",show_status:!1},timeNavigator:{alias:"Chart",show_status:!1},smoothing:{alias:"Reduce Noise",show_status:!0},anomalyDetection:{alias:"Detect Anomalies",show_status:!0},impactSwitch:{alias:"Filters",show_status:!0},growthViews:{alias:"Growth Views",show_status:!0}};var b=function(a){console.log("modal init"),this.closeButton=null,this.modal=null,this.overlay=null,this.transitionEnd=i();var b={autoOpen:!1,className:"fade-and-drop",closeButton:!0,content:"",overflow:"hidden",overlay:!0};"iOS"===a.modal_type?(b.minWidth="80%",b.maxWidth="80%",b.minHeight="80%",b.maxHeight="80%",b.top="10%",b.left="10%"):(b.minWidth="50%",b.maxWidth="50%",b.minHeight="50%",b.maxHeight="50%",b.top="25%",b.left="25%"),arguments[0]&&"object"==typeof arguments[0]&&(this.options=g(b,arguments[0])),d.call(this)},c=function(a,b){var c,d=this;if(this.modal.className=this.modal.className.replace(" scotch-open",""),this.overlay.className=this.overlay.className.replace(" scotch-open",""),this.modal.addEventListener(this.transitionEnd,function(){d.modal.parentNode.removeChild(d.modal)}),this.overlay.addEventListener(this.transitionEnd,function(){d.overlay.parentNode&&d.overlay.parentNode.removeChild(d.overlay)}),a&&(c=document.getElementById(a+"_svg"),c.setAttribute("width",TimeSeries.chart_options[a].width+"px"),c.setAttribute("height",TimeSeries.chart_options[a].height+"px"),document.getElementById(a).appendChild(c)),TimeSeries.chart_configs[a]){var e=TimeSeries.chart_configs[a].wasLiveDataPaused;e||TimeSeries.mediator.publish("resumeLiveData",a+"_cfr"),b&&d3.select("#"+a+"_highlight").style({visibility:"visible",opacity:"0.4"}).transition().duration(800).ease("linear").style({opacity:"0"}).transition().style({visibility:"hidden"})}},d=function(){e.call(this),this.modal.className=this.modal.className+(this.modal.offsetHeight>window.innerHeight?" scotch-open scotch-anchored":" scotch-open"),this.overlay.className=this.overlay.className+" scotch-open",$(".toggle_form_controls").attr({"data-size":"mini","data-on-color":"success","data-handle-width":"20px","data-label-width":"2px"}).bootstrapSwitch()},e=function(){var b,c,d,e,i,k,l,m,n;if(chart_id=this.options.selector,c=document.createDocumentFragment(),this.modal=document.createElement("div"),this.modal.className="scotch-modal "+this.options.className,this.modal.style.top=this.options.top,this.modal.style.left=this.options.left,TimeSeries.isMobile?this.modal.style.width="80%":(this.modal.style.width="auto",this.modal.style.minWidth=this.options.minWidth,this.modal.style.maxWidth=this.options.maxWidth,this.modal.style.minHeight=this.options.minHeight,this.modal.style.maxHeight=this.options.maxHeight),this.modal.style.overflow=this.options.overflow,this.options.overlay===!0&&(this.overlay=document.createElement("div"),this.overlay.className="scotch-overlay "+this.options.className,this.overlay.addEventListener("click",a.click),c.appendChild(this.overlay)),n=document.createElement("div"),n.className="comcharts-TS-modal-inner-container",this.options.close_text&&(s=document.createElement("div"),s.innerHTML="<span class='comcharts-TS-modal-close'>"+this.options.close_text+"</span>",s.style.textAlign="right",s.style.right="0px",s.style.position="absolute",s.style.zIndex="1002",s.style.right="10px",s.style.top="12px",s.addEventListener("click",a.click),n.appendChild(s)),this.options.modal_title){var o=document.createElement("div");o.innerHTML=this.options.modal_title,o.className="comcharts-TS-modal-chartarea-title",o.style["float"]="none",n.appendChild(o)}switch(this.options.modal_type){case"iOS":var p,q,r,s,t,u,v,w,x,y="",z=TimeSeries.clubFeaturesInModal[this.options.feature_name],A=z.length,B="";for(p=document.createElement("div"),p.className="col-sm-2 comcharts-TS-modal-feature-list",q=document.createElement("div"),TimeSeries.chart_options[this.options.selector].isTimeNavigator?(this.modal.style.top="20%",this.modal.style.left="20%",this.modal.style["min-width"]="60%",this.modal.style["max-width"]="60%",this.modal.style["min-height"]="30%",this.modal.style["max-height"]="60%",q.className="col-sm-12 comcharts-TS-feature-container"):q.className="col-sm-10 comcharts-TS-feature-container",r=document.createElement("div"),r.innerHTML="Settings",r.className="comcharts-TS-modal-title",y+='<ul id="myTabs" class="nav nav-pills nav-stacked comcharts-TS-modal-feature" role="tablist">',t=document.createElement("div"),t.id="myTabContent",t.className="tab-content",v=0;A>v;v++)each_feature_in_modal=z[v],alias=TimeSeries.featureAlias[each_feature_in_modal].alias,("timeNavigator"===each_feature_in_modal||TimeSeries.chartToFeatureMapping[this.options.selector]&&TimeSeries.chartToFeatureMapping[this.options.selector].indexOf(each_feature_in_modal)>-1)&&(g(this.options,TimeSeries.mediator.publish(each_feature_in_modal+"Modal",this.options.parameters)),b=this.options.content||"",e=document.createElement("div"),e.className="vm-modal-body","string"==typeof b?e.innerHTML+=b:e.appendChild(b),i=document.createElement("div"),i.className="vm-modal-buttons",window.opt=this.options,this.options.apply_id&&(k=document.createElement("div"),k.id=this.options.apply_id,k.className="apply-button deactive",k.appendChild(document.createTextNode("Apply")),k.addEventListener("click",function(){opt.callbacks&&opt.callbacks.afterApply&&(x=opt.callbacks.afterApply),TimeSeries.mediator.publish(this.id.split("_apply_")[1]+"OnClick",chart_id,x),TimeSeries.mediator.publish("closeModal",options.selector)}),i.appendChild(k)),this.options.description&&!TimeSeries.isMobile&&(l=document.createElement("div"),l.className="vm-modal-subtitle",l.appendChild(document.createTextNode(this.options.description))),m=document.createElement("div"),m.style.clear="both",B=this.options.selected_tab===each_feature_in_modal?" active":"",w=TimeSeries.featureAlias[each_feature_in_modal].show_status?TimeSeries.chart_configs[this.options.selector].feature_status[each_feature_in_modal]?"On":"Off":"",y+='<li role="presentation" class="'+B+'"><a href="#'+each_feature_in_modal+'_tab_content"id="'+each_feature_in_modal+'-tab"role="tab" data-toggle="tab"aria-controls="'+each_feature_in_modal+'"aria-expanded="true">'+alias+'<span class="feature_status">'+w+"</span></a></li>",u=document.createElement("div"),u.id=each_feature_in_modal+"_tab_content",u.className="tab-pane fade in"+B,u.role="tabpanel",u["aria-labelledby"]=each_feature_in_modal+"-tab",u.appendChild(e),u.appendChild(i),u.appendChild(m),t.appendChild(u));y+="</ul>",d3.select(p).html(y),q.appendChild(t),TimeSeries.chart_options[this.options.selector].isTimeNavigator||n.appendChild(p),n.appendChild(q),this.modal.appendChild(n);break;case"custom":var C=this.options.apply_text||"Apply";d=j(this.options.apply,this.options.apply_on,this.options.help_id?this.options.help_id:"modal_help",this.options.help_text,this.options.suffix?this.options.suffix:"",this.options.type),
b=this.options.content||"",e=document.createElement("div"),e.className="vm-modal-body",this.options.modalBodyClassName&&(e.className+=" "+this.options.modalBodyClassName),"string"==typeof b?e.innerHTML+=b:e.appendChild(b),i=document.createElement("div"),i.className="vm-modal-buttons",this.options.buttonsClass&&(i.className+=" "+this.options.buttonsClass),this.options.apply_id&&(k=document.createElement("div"),k.id=this.options.apply_id,k.className="apply-button deactive",k.appendChild(document.createTextNode(C)),i.appendChild(k)),this.options.description&&!TimeSeries.isMobile&&(l=document.createElement("div"),l.className="vm-modal-subtitle",l.appendChild(document.createTextNode(this.options.description))),m=document.createElement("div"),m.style.clear="both",this.options.apply&&n.appendChild(d),this.options.description&&!TimeSeries.isMobile&&n.appendChild(l),n.appendChild(e),n.appendChild(i),n.appendChild(m),this.modal.appendChild(n)}c.appendChild(this.modal),document.body.appendChild(c),"iOS"===this.options.modal_type&&($('a[data-toggle="tab"]').on("shown.bs.tab",function(a){var b=a.target.id.split("-")[0];f(chart_id,b)}),document.querySelector(".scotch-modal .comcharts-TS-feature-container").style.minHeight=document.querySelector(".scotch-modal").getBoundingClientRect().height+"px",d3.selectAll(".scotch-modal .comcharts-TS-modal-chartarea").style("min-height",document.querySelector(".scotch-modal").getBoundingClientRect().height+"px")),TimeSeries.chart_options[this.options.selector]&&TimeSeries.chart_options[this.options.selector].isTimeNavigator&&document.querySelector(".comcharts-TS-modal-non-chartarea.comcharts-TS-modal-non-chartarea-TN")&&(document.querySelector(".comcharts-TS-modal-non-chartarea.comcharts-TS-modal-non-chartarea-TN").style.height=document.querySelector(".scotch-modal").getBoundingClientRect().height+"px");var D;document.getElementById(this.options.selector+"_anomaly_detection_series_div")&&(D=document.querySelector(".scotch-modal").offsetHeight-document.querySelector(".comcharts-TS-content-sub-heading").offsetHeight-document.querySelector(".comcharts-TS-category-modal").offsetHeight-140,document.getElementById(this.options.selector+"_anomaly_detection_series_div").style.height=D+"px"),document.getElementById(this.options.selector+"_smoothing_series_div")&&(D=document.querySelector(".scotch-modal").offsetHeight-document.querySelector(".comcharts-TS-content-sub-heading").offsetHeight-document.querySelector(".comcharts-TS-category-modal").offsetHeight-140,document.getElementById(this.options.selector+"_smoothing_series_div").style.height=D+"px"),document.getElementById(this.options.selector+"_TN_series_div")&&(D=document.querySelector(".modal-body-content").offsetHeight-document.querySelector(".comcharts-TS-modal-chartarea-title").offsetHeight-80,document.getElementById(this.options.selector+"_TN_series_div").style.height=D+"px"),h(this.options,this.options.modal_type)},f=function(a,b){var c,d,e,f=document.getElementById(a+"_svg"),g=parseInt(f.getAttribute("data-height")),h=parseInt(f.getAttribute("data-width")),i=document.querySelector(".scotch-modal").getBoundingClientRect().height,j=document.getElementById(b+"_modal_chartarea");d=g>i&&i>0?i:g,j&&(e=j.offsetWidth,console.log(h,e),c=h>e&&e>0?e:h,console.log(d,"height"),f.setAttribute("width",c+"px"),f.setAttribute("height",d+"px"),j.appendChild(f))},g=function(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},h=function(b,c){b.callbacks&&b.callbacks.afterOpen&&b.callbacks.afterOpen(b.selector),a.on("click.modal-close",function(){"iOS"===c?TimeSeries.mediator.publish("closeModal",b.selector||b.parameters.selector):TimeSeries.mediator.publish("closeModal"),b.callbacks&&b.callbacks.afterClose&&b.callbacks.afterClose(b.selector)}),document.onkeydown=function(b){b=b||window.event,27==b.keyCode&&a.click()}},i=function(){var a=document.createElement("div");return a.style.WebkitTransition?"webkitTransitionEnd":a.style.OTransition?"oTransitionEnd":"transitionend"},j=function(a,b,c,d,e,f){var g=document.createElement("div");return g.className="vm-modal-heading",g.innerHTML="<div class='comcharts-TS-vm-modal-heading-div'>",TimeSeries.isMobile&&"undefined"!=typeof d&&(g.innerHTML+="<span id ='"+c+"' class='modal-help'>"+d+"</span>"),g.innerHTML+="</div><div></div><span class='modal-title-bold'>"+a+"</span>",b&&(TimeSeries.isMobile||"feature"!==f?"feature"===f?g.innerHTML+="<div class='for'> for "+b+"</div>":"help_individual"===f&&(g.innerHTML+="<span class='for'>"+b+"</span><span class='for'>"+e+"</span>"):g.innerHTML+="<span class='for'> for </span><span class='for'>"+b+"</span>"),g},k=function(a,b,c){var d=document.createElement("div");return d.className="when-loading",d.innerHTML="<div class='loader-div'><div id='preloader_1'><span></span><span></span><span></span><span></span><span></span></div><br><div class='applying-text'>"+a+"</div></div>",d.style.width=b+"px",d.style.height=c+"px",d};return TimeSeries.mediator.subscribe("initModal",b),TimeSeries.mediator.subscribe("renderModal",h),TimeSeries.mediator.subscribe("openModal",d),TimeSeries.mediator.subscribe("closeModal",c),TimeSeries.mediator.subscribe("createLoader",k),TimeSeries.mediator.subscribe("extendDefaults",g),{init:b,open:d,close:c}}(),{seeVisualComparison:seeVisualComparison,seeTimeShift:seeTimeShift,updateVisualComparison:updateVisualComparison,seeDimensionalAnalysis:seeDimensionalAnalysis,updateDimensionalAnalysis:updateDimensionalAnalysis,applySmoothing:applySmoothing,applyAnomalyDetection:applyAnomalyDetection,dimensionFilter:dimensionFilter,rangeFilter:rangeFilter,createFilter:createFilter,createMenuBar:createMenuBar,createChart:createChart,get assets(){return TimeSeries.assets},set assets(a){TimeSeries.validation.dataTypes(a,"string")?TimeSeries.assets=a:TimeSeries.assets="/"},TimeSeries:TimeSeries}}();